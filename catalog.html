<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Kelly+Slab&family=Spectral:wght@300;400;600&display=swap"
            rel="stylesheet"
        />
        <title>–°—ã—Ä & –ö–æ - –ö–∞—Ç–∞–ª–æ–≥ –∏ –ö–æ—Ä–∑–∏–Ω–∞</title>
        <link rel="stylesheet" href="styles/catalog.css" />
    </head>
    <body>
        <header>
            <a href="index.html" class="logo"> –°—ã—Ä & –ö–æ </a>
            <nav>
                <a href="catalog.html">–ö–∞—Ç–∞–ª–æ–≥</a>
                <a href="sell.html">–ê–∫—Ü–∏–∏</a>
                <a href="blog.html">–ë–ª–æ–≥</a>
                <a href="contacts.html">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>

                <div class="cart-icon" id="cart-icon">
                    –ö–æ—Ä–∑–∏–Ω–∞ üõí (<span id="cart-count">0</span>)
                </div>

                <div class="cart-dropdown" id="cart-dropdown">
                    <ul class="cart-list" id="cart-list"></ul>
                    <div class="cart-total">
                        –ò—Ç–æ–≥: <span id="cart-total">0</span> ‚ÇΩ
                    </div>
                    <button class="checkout-link" id="open-cart-btn">
                        –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É
                    </button>
                </div>
            </nav>
        </header>

        <main id="catalog">
            <h1 class="catalog-title">–ö–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ–¥—É–∫—Ü–∏–∏</h1>

            <div class="search-bar">
                <input
                    type="text"
                    id="search-input"
                    placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..."
                />
            </div>

            <div class="tags" id="tags-container">
                <!-- –¢–µ–≥–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>

            <div class="products" id="products-container">
                <!-- –¢–æ–≤–∞—Ä—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </main>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ—Ä–∑–∏–Ω—ã -->
        <div id="modal-cart">
            <div class="modal-content">
                <button class="modal-close" id="modal-close">&times;</button>
                <div class="modal-header">–ö–æ—Ä–∑–∏–Ω–∞</div>
                <ul class="modal-cart-list" id="modal-cart-list"></ul>
                <div class="modal-cart-total">
                    –ò—Ç–æ–≥: <span id="modal-cart-total-price">0</span> ‚ÇΩ
                </div>
                <button class="modal-checkout-btn" id="modal-checkout-btn">
                    –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
                </button>
            </div>
        </div>

        <footer>
            <div class="footer-block">
                <div class="logo">–°—ã—Ä & –ö–æ</div>
                <div class="social-icons">
                    <a href="tel:+79262227122"
                        ><img src="image (1).png" alt="phone"
                    /></a>
                    <a href="https://vk.com/yourcompany" target="_blank"
                        ><img src="image (2).png" alt="vk"
                    /></a>
                    <a href="https://t.me/yourcompany" target="_blank"
                        ><img src="image (3).png" alt="telegram"
                    /></a>
                </div>
            </div>

            <div class="footer-divider"></div>

            <div class="footer-block">
                <p>
                    <strong>–ê–¥—Ä–µ—Å:</strong><br />–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫, —É–ª. –©–æ—Ä—Å–∞, 49<br />10:00
                    ‚Äì 22:00
                </p>
            </div>

            <div class="footer-divider"></div>

            <div class="footer-block">
                <p>
                    <strong>–ö–æ–Ω—Ç–∞–∫—Ç—ã:</strong><br />+7 (926) 222-71-22<br />yoprosi@gmail.com<br />–ò–ù–ù:
                    212340344883473
                </p>
            </div>
        </footer>

        <button id="btn-top" title="–ù–∞–≤–µ—Ä—Ö">‚¨ÜÔ∏è</button>

        <script>
            const products = [
                {
                    id: 1,
                    name: "–°—ã—Ä –ë—Ä–∏",
                    pricePer100g: 250,
                    image: "–±—Ä–∏.png",
                    tags: ["–º—è–≥–∫–∏–π", "—Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π", "–º–æ–ª–æ—á–Ω—ã–π"],
                },
                {
                    id: 2,
                    name: "–°—ã—Ä –ü–∞—Ä–º–µ–∑–∞–Ω",
                    pricePer100g: 450,
                    image: "–ø–∞—Ä.png",
                    tags: ["—Ç–≤—ë—Ä–¥—ã–π", "–∏—Ç–∞–ª—å—è–Ω—Å–∫–∏–π", "–∑—Ä–µ–ª—ã–π"],
                },
                {
                    id: 3,
                    name: "–°—ã—Ä –ß–µ–¥–¥–µ—Ä",
                    pricePer100g: 300,
                    image: "—á–µ–¥–¥–µ—Ä.jpg",
                    tags: ["—Ç–≤—ë—Ä–¥—ã–π", "–∞–Ω–≥–ª–∏–π—Å–∫–∏–π", "–º–æ–ª–æ—á–Ω—ã–π"],
                },
                {
                    id: 4,
                    name: "–°—ã—Ä –ú–æ—Ü–∞—Ä–µ–ª–ª–∞",
                    pricePer100g: 200,
                    image: "–º–æ—Ü.png",
                    tags: ["–º—è–≥–∫–∏–π", "–∏—Ç–∞–ª—å—è–Ω—Å–∫–∏–π", "—Å–≤–µ–∂–∏–π"],
                },
                {
                    id: 5,
                    name: "–°—ã—Ä –ì–∞—É–¥–∞",
                    pricePer100g: 280,
                    image: "–≥–∞—É–¥–∞.jpg",
                    tags: ["—Ç–≤—ë—Ä–¥—ã–π", "–≥–æ–ª–ª–∞–Ω–¥—Å–∫–∏–π", "–º–æ–ª–æ—á–Ω—ã–π"],
                },
            ];

            // --- UI elements ---
            const productsContainer =
                document.getElementById("products-container");
            const tagsContainer = document.getElementById("tags-container");
            const searchInput = document.getElementById("search-input");
            const cartCount = document.getElementById("cart-count");
            const cartList = document.getElementById("cart-list");
            const cartTotal = document.getElementById("cart-total");
            const cartIcon = document.getElementById("cart-icon");
            const cartDropdown = document.getElementById("cart-dropdown");
            const openCartBtn = document.getElementById("open-cart-btn");

            const modalCart = document.getElementById("modal-cart");
            const modalClose = document.getElementById("modal-close");
            const modalCartList = document.getElementById("modal-cart-list");
            const modalCartTotalPrice = document.getElementById(
                "modal-cart-total-price"
            );
            const modalCheckoutBtn =
                document.getElementById("modal-checkout-btn");

            // --- –ö–æ—Ä–∑–∏–Ω–∞ ---
            // –°—Ç—Ä—É–∫—Ç—É—Ä–∞: { productId: { id, name, pricePer100g, weight, image } }
            let cart = {};

            // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã –∏–∑ localStorage
            function loadCart() {
                const stored = localStorage.getItem("cart");
                if (stored) {
                    cart = JSON.parse(stored);
                } else {
                    cart = {};
                }
            }

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã –≤ localStorage
            function saveCart() {
                localStorage.setItem("cart", JSON.stringify(cart));
            }

            // –ü–æ–¥—Å—á–µ—Ç –∏—Ç–æ–≥–∞ –∫–æ—Ä–∑–∏–Ω—ã
            function getCartTotal() {
                let total = 0;
                for (const id in cart) {
                    const item = cart[id];
                    total += (item.pricePer100g * item.weight) / 100;
                }
                return total.toFixed(2);
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –∏ —Å–ø–∏—Å–∫–∞ –≤ —à–∞–ø–∫–µ
            function updateCartUI() {
                const count = Object.values(cart).reduce(
                    (acc, item) => acc + item.weight,
                    0
                );
                cartCount.textContent = count.toFixed(0);

                cartList.innerHTML = "";
                if (count === 0) {
                    cartList.innerHTML = `<li class="empty-cart">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</li>`;
                    cartTotal.textContent = "0";
                    return;
                }
                for (const id in cart) {
                    const item = cart[id];
                    const li = document.createElement("li");
                    li.textContent = `${item.name} ‚Äî ${item.weight} –≥`;
                    const span = document.createElement("span");
                    span.textContent = `${(
                        (item.pricePer100g * item.weight) /
                        100
                    ).toFixed(2)} ‚ÇΩ`;
                    li.appendChild(span);
                    cartList.appendChild(li);
                }
                cartTotal.textContent = getCartTotal();
            }

            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É
            function addToCart(product, weight) {
                if (weight <= 0) return;
                if (cart[product.id]) {
                    cart[product.id].weight += weight;
                } else {
                    cart[product.id] = {
                        id: product.id,
                        name: product.name,
                        pricePer100g: product.pricePer100g,
                        weight: weight,
                        image: product.image,
                    };
                }
                saveCart();
                updateCartUI();
            }

            // –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
            function removeFromCart(productId) {
                delete cart[productId];
                saveCart();
                updateCartUI();
            }

            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–µ—Å–∞ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ (–≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ)
            function updateItemWeight(productId, newWeight) {
                if (newWeight <= 0) {
                    removeFromCart(productId);
                } else {
                    cart[productId].weight = newWeight;
                }
                saveCart();
                updateCartUI();
                renderModalCart();
            }

            // --- –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ ---
            // –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–µ–≥–∏
            function getUniqueTags() {
                const allTags = products.flatMap((p) => p.tags);
                return [...new Set(allTags)];
            }

            // –ê–∫—Ç–∏–≤–Ω—ã–π —Ç–µ–≥ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
            let activeTag = null;

            // –§–∏–ª—å—Ç—Ä –ø–æ —Ç–µ–≥–∞–º –∏ –ø–æ–∏—Å–∫—É
            function filterProducts() {
                const searchText = searchInput.value.trim().toLowerCase();

                return products.filter((p) => {
                    // –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
                    if (
                        searchText &&
                        !p.name.toLowerCase().includes(searchText)
                    ) {
                        return false;
                    }
                    // –§–∏–ª—å—Ç—Ä –ø–æ —Ç–µ–≥—É
                    if (activeTag && !p.tags.includes(activeTag)) {
                        return false;
                    }
                    return true;
                });
            }

            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–µ–≥–æ–≤
            function renderTags() {
                tagsContainer.innerHTML = "";
                const uniqueTags = getUniqueTags();
                uniqueTags.forEach((tag) => {
                    const tagEl = document.createElement("span");
                    tagEl.className = "tag";
                    if (tag === activeTag) tagEl.classList.add("active");
                    tagEl.textContent = tag;
                    tagEl.addEventListener("click", () => {
                        if (activeTag === tag) {
                            activeTag = null;
                        } else {
                            activeTag = tag;
                        }
                        renderTags();
                        renderProducts();
                    });
                    tagsContainer.appendChild(tagEl);
                });
            }

            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∫–∞—Ç–∞–ª–æ–≥–∞
            function renderProducts() {
                const filtered = filterProducts();
                productsContainer.innerHTML = "";
                if (filtered.length === 0) {
                    productsContainer.textContent = "–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã";
                    return;
                }
                filtered.forEach((product) => {
                    const card = document.createElement("div");
                    card.className = "product-card";

                    card.innerHTML = `
        <img src="${product.image}" alt="${product.name}" />
        <h3>${product.name}</h3>
        <p>–¶–µ–Ω–∞: ${product.pricePer100g} ‚ÇΩ / 100 –≥</p>
        <p>–¢–µ–≥–∏: ${product.tags.join(", ")}</p>
        <div class="product-actions">
          <input type="number" min="50" step="50" value="100" aria-label="–í–µ—Å –≤ –≥—Ä–∞–º–º–∞—Ö" />
          <button>–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
        </div>
      `;

                    const input = card.querySelector("input");
                    const button = card.querySelector("button");

                    button.addEventListener("click", () => {
                        const weight = parseInt(input.value);
                        if (isNaN(weight) || weight < 50) {
                            alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–µ—Å (–Ω–µ –º–µ–Ω–µ–µ 50 –≥)");
                            return;
                        }
                        addToCart(product, weight);
                    });

                    productsContainer.appendChild(card);
                });
            }

            // --- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ—Ä–∑–∏–Ω—ã ---
            function renderModalCart() {
                modalCartList.innerHTML = "";
                const ids = Object.keys(cart);
                if (ids.length === 0) {
                    modalCartList.innerHTML = `<li class="empty-cart">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</li>`;
                    modalCartTotalPrice.textContent = "0";
                    return;
                }
                ids.forEach((id) => {
                    const item = cart[id];
                    const li = document.createElement("li");

                    li.innerHTML = `
        <div class="item-info">
          <p><strong>${item.name}</strong></p>
          <p>–¶–µ–Ω–∞: ${item.pricePer100g} ‚ÇΩ / 100 –≥</p>
        </div>
        <div class="item-actions">
          <input type="number" min="50" step="50" value="${item.weight}" aria-label="–í–µ—Å —Ç–æ–≤–∞—Ä–∞" />
          <button title="–û–±–Ω–æ–≤–∏—Ç—å">‚úé</button>
          <button title="–£–¥–∞–ª–∏—Ç—å" class="remove-btn">‚úñ</button>
        </div>
      `;

                    const input = li.querySelector("input");
                    const updateBtn = li.querySelector(
                        "button:not(.remove-btn)"
                    );
                    const removeBtn = li.querySelector(".remove-btn");

                    updateBtn.addEventListener("click", () => {
                        const newWeight = parseInt(input.value);
                        if (isNaN(newWeight) || newWeight < 50) {
                            alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–µ—Å (–Ω–µ –º–µ–Ω–µ–µ 50 –≥)");
                            input.value = item.weight;
                            return;
                        }
                        updateItemWeight(id, newWeight);
                    });

                    removeBtn.addEventListener("click", () => {
                        if (confirm(`–£–¥–∞–ª–∏—Ç—å ${item.name} –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã?`)) {
                            removeFromCart(id);
                            renderModalCart();
                        }
                    });

                    modalCartList.appendChild(li);
                });
                modalCartTotalPrice.textContent = getCartTotal();
            }

            // –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ—Ä–∑–∏–Ω—ã
            function openModalCart() {
                renderModalCart();
                modalCart.classList.add("active");
                document.body.style.overflow = "hidden";
            }
            // –ó–∞–∫—Ä—ã—Ç—å
            function closeModalCart() {
                modalCart.classList.remove("active");
                document.body.style.overflow = "auto";
            }

            // --- –°–æ–±—ã—Ç–∏—è ---
            searchInput.addEventListener("input", () => {
                renderProducts();
            });

            openCartBtn.addEventListener("click", () => {
                openModalCart();
            });

            modalClose.addEventListener("click", () => {
                closeModalCart();
            });

            modalCart.addEventListener("click", (e) => {
                if (e.target === modalCart) {
                    closeModalCart();
                }
            });

            modalCheckoutBtn.addEventListener("click", () => {
                alert(
                    "–°–ø–∞—Å–∏–±–æ –∑–∞ –∑–∞–∫–∞–∑! (–î–∞–ª—å–Ω–µ–π—à–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)"
                );
                cart = {};
                saveCart();
                updateCartUI();
                renderModalCart();
                closeModalCart();
            });

            // --- –ö–Ω–æ–ø–∫–∞ –Ω–∞–≤–≤–µ—Ä—Ö ---
            const btnTop = document.getElementById("btn-top");
            window.addEventListener("scroll", () => {
                if (window.scrollY > 400) {
                    btnTop.style.display = "flex";
                } else {
                    btnTop.style.display = "none";
                }
            });
            btnTop.addEventListener("click", () => {
                window.scrollTo({ top: 0, behavior: "smooth" });
            });

            // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
            loadCart();
            updateCartUI();
            renderTags();
            renderProducts();
        </script>
    </body>
</html>